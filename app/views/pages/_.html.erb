<script src="http://code.jquery.com/jquery-latest.min.js"></script>

<div class="container">
  <h1 style="text-align: center">Sales Admin</h1>

  <div id="dvImportSegments" class="fileupload ">
      <fieldset>
          <legend>Upload your CSV File</legend>
              <input type="file" name="File Upload" id="txtFileUpload" accept=".csv" />
     </fieldset>
  </div>


  <div class="subcontainer"></div>

</div>



<script type="text/javascript">

// Method that checks that the browser supports the HTML5 File API
function compatibleBrowser() {
    var isCompatible = false;
    if (window.File && window.FileReader && window.FileList && window.Blob) {
      isCompatible = true;
    }
    return isCompatible;
}

// Method that reads and processes the selected file
function upload(event){
  if (!compatibleBrowser()) {
    alert('File APIs (HTML5) are not available with this browser!');
  } else {
    var data = null;
    var file = event.target.files[0];
    var reader = new FileReader();
    reader.readAsText(file);
    totalRevenue = 0;
    reader.onload = function(event) {
        var csvData = event.target.result;
        let lines = csvData.split("\n");
        var row = 0;
        var headers = null;
        var headerIndex = 0
        var priceIndex = 0;
        var quantityIndex = 0;
        lines.forEach(function(line) {
          var elts = line.split(",");
          if(row == 0) {
            headers = elts;
            headers.forEach(function(header){
              if (header === "Item Price") {
                priceIndex = headerIndex;
              }
              if (header === "Quantity") {
                quantityIndex = headerIndex;
              }
              headerIndex += 1;
            })
          }
          else {
            totalRevenue += parseFloat(elts[priceIndex])*parseFloat(elts[quantityIndex]);
          }
          row += 1;
        });

        $('.subcontainer').html('</br>$'+totalRevenue);
    };
    reader.onerror = function() {
        alert('Unable to read ' + file.fileName);
    };
  }
}

$(document).ready(function() {
  // The event listener for the file upload
  document.getElementById('txtFileUpload').addEventListener('change', upload, false);
});




</script>
